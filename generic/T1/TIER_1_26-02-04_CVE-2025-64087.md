## Executive Summary

CVE-2025-64087 is a Server-Side Template Injection (SSTI) vulnerability in the FreeMarker integration of opensagres XDocReport versions 1.0.0–2.1.0. When an application uses XDocReport with FreeMarker to process attacker-controlled DOCX templates, crafted template expressions such as `${"freemarker.template.utility.Execute"?new()("whoami")}` can trigger arbitrary command execution on the server. In deployments where untrusted users can upload or influence DOCX templates (for example, customer-facing portals or document-automation services), this provides a direct unauthenticated RCE path on the application host.

From a kill chain perspective this is a high-utility, low-friction exploit whenever template input can be influenced over the network: attack complexity is low, PoCs are public, and the vulnerability executes with the privileges of the application process, which often has access to sensitive data and credentials. Where XDocReport/FreeMarker is used only internally with trusted templates and strong change control, the exposure drops sharply; but across the generic ecosystem of Java web applications using document templating, this is classic “low-hanging fruit” for adversaries scanning for exploitable upload or template-editing workflows.

Assessment Tier: TIER 1 (Immediate – Network-Accessible RCE via Template Engine)
Full analysis: https://github.com/alan-turing-institute/cyber-threat-observatory/blob/main/generic/T1/TIER_1_26-02-04_CVE-2025-64087.md
Rationale:
- Remote code execution through FreeMarker SSTI when DOCX/templating input is attacker-controlled and processed server-side
- No authentication or special privileges required beyond access to a template or upload surface; widely applicable to generic web apps using XDocReport
- Public exploit code and detailed reverse-engineering significantly lower attacker fixed costs
- High impact on confidentiality, integrity, and availability of application servers, with strong fit for automated mass exploitation
Attractiveness Score: HIGH
DPI Relevance: General Infrastructure (Document Templating / Middleware)
Vulners reference: https://vulners.com/cve/CVE-2025-64087

---

## In-Depth Analysis

### 1. Software and Deployment Context

- **Software:** opensagres XDocReport with FreeMarker template engine
- **Role:** Generates DOCX reports by merging application data into template documents
- **Typical deployment:**
  - Embedded into Java web applications and services to render dynamic documents
  - Executed in CI or batch processes for automated document production
- **Network reachability:**
  - Any HTTP/S endpoint that accepts DOCX templates, or allows editing/creation of templates persisted on the server, becomes a de facto entry point
- **Execution context:**
  - Runs under the application’s JVM identity; often has broad file, network, and database access

This makes XDocReport/FreeMarker an attractive pivot layer between user-controlled document content and high-privilege server-side execution.

### 2. Vulnerability Mechanics

- **Root cause:** The FreeMarker engine is configured in a way that allows access to powerful utilities such as `freemarker.template.utility.Execute` and Java reflection/API exposure in templates.
- **Exploit pattern (per PoC):**
  - Attacker embeds template expressions like:
    - `${"freemarker.template.utility.Execute"?new()("calc")}`
    - `${"freemarker.template.utility.Execute"?new()("powershell -e ...")}`
  - XDocReport loads the DOCX template and passes its XML content into FreeMarker without prior sanitisation or sandboxing.
  - During `report.process(context, out)`, FreeMarker parses and evaluates these expressions, invoking OS commands on the server.
- **Scope:**
  - Affects XDocReport versions 1.0.0–2.1.0 using the FreeMarker engine
  - Exploitable wherever untrusted document content is rendered through this integration

This is a textbook SSTI: user-controlled template data is interpreted as code in the server-side rendering engine.

### 3. Kill Chain Utility Assessment

**Initial access vs post-compromise**

- When DOCX templates are:
  - Uploaded directly by users, or
  - Derived from user-editable content (e.g. WYSIWYG fields saved into templates), and
  - Rendered via XDocReport+FreeMarker,
- CVE-2025-64087 acts as an **initial-access RCE vector** with no need for prior compromise, credentials, or MitM.

**Attacker gain**

- **Code execution** on application servers enables:
  - Theft of secrets, configuration, and data
  - Lateral movement into databases and adjacent services
  - Establishment of persistence or further backdoors in generated documents and code
- **Supply-chain angle:** Exploit payloads embedded in templates can propagate into generated artefacts, potentially affecting downstream consumers if those artefacts are further processed.

**Barriers and reliability**

- Public exploits and detailed debugging notes show consistent RCE across affected versions when payload-bearing templates are rendered.
- The main prerequisite is the ability to influence template content; in many real systems, this comes “for free” via upload or admin/customisation features exposed to semi-trusted users.

Given the combination of ease, impact, and the ubiquity of FreeMarker-based templating patterns, this vulnerability has high immediate kill chain utility where environment fit exists.

### 4. Organisational Context and DPI Relevance

- **DPI / critical infrastructure:** XDocReport is not DPI-specific but can be embedded in systems that generate critical reports, invoices, or statutory documents.
- **Generic and SME environments:** Particularly relevant to SaaS platforms, HR/finance systems, and custom portals where customers or staff upload forms/templates or design document layouts.
- **DPI relevance classification:** General Infrastructure – compromise primarily affects document services and underlying app servers, not core DPI rails directly.

The vulnerability warrants Tier 1 handling in any environment where template input is exposed over the network, regardless of sector.

### 5. Exploit Availability and Threat Signals

- **PoC status:** Public GitHub exploit repository demonstrates:
  - Command execution (`calc`, `whoami`, PowerShell reverse shells)
  - Detailed analysis of the FreeMarker execution path and AST visitation
- **EPSS:** Slightly elevated relative to background, reflecting interest in code-execution flaws in common Java libraries.
- **Vendor response:** A pull request and commits harden FreeMarker usage (e.g. disabling dangerous built-ins and validating templates), but not all consumers may have upgraded.

From a WAA standpoint, the ready-to-use PoCs and deep technical writeups dramatically lower the fixed cost of targeting any web app that meets the basic upload/template conditions.

### 6. Recommended Mitigations

- **Patch / upgrade:**
  - Update to a version of XDocReport where FreeMarker is configured with:
    - Dangerous utilities (`Execute`, `?api`, `?new`) disabled
    - Strong restrictions on reflection and class access
- **Template handling:**
  - Treat templates as code-equivalent: restrict who can upload or edit them.
  - Avoid rendering templates that originate from untrusted tenants or external parties.
- **Engine hardening:**
  - Explicitly configure FreeMarker with:
    - `APIBuiltinEnabled=false`
    - Custom `ObjectWrapper` and `TemplateClassResolver` that block arbitrary class loading and command execution
  - Add static validation to reject templates containing known dangerous patterns.
- **Environmental controls:**
  - Run document rendering in isolated, least-privilege containers with minimal filesystem and network access.
  - Monitor for suspicious child process creation originating from document-processing services.

These mitigations increase attacker effort and reduce achievable gain, lowering the effective kill chain utility for opportunistic campaigns.

